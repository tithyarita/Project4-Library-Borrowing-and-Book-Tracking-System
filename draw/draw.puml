@startuml
!pragma teoz true

' =====================
' MEMBER BORROW & RETURN FLOW
' =====================

|Member|
start
:Register / Login;
:Search Book;

|System|
if (Book Available?) then (Yes)

    if (Has Unreturned Book?) then (Yes)
        :Reject Borrow;
        :Send Fail Message;
        stop
    else (No)

        if (Borrowed 3 Books This Week?) then (Yes)
            :Reject Borrow;
            :Send Fail Message;
            stop
        else (No)

            |Member|
            :Choose Borrow or Booking;

            |System|
            :Generate Receipt;

            ' =====================
            ' Receipt goes to both Member and Librarian
            ' =====================
            fork
                |Member|
                :Receive Receipt;
            fork again
                |Librarian|
                :Receive Receipt;
                :Record Receipt;
                :Set Book Status (Booked / Borrowed);
            end fork

            |Member|
            :Come to Library;

            |Librarian|
            :Approve Receipt;
            :Confirm Borrow;
            :Set Return Date;

        endif
    endif

else (No)
    :Display "Book Unavailable";
    stop
endif

' =====================
' RETURN FLOW
' =====================

|Member|
:Return Book;

|Librarian|
:Process Return;
:Update Book Status;

|System|
if (Returned On Time?) then (Yes)
    :Record Return;
    :Member Status = Active;
else (Late > 3 Days)
    :Record Late Return;
    :Member Status = Blacklisted;
endif

' =====================
' LIBRARIAN MANAGEMENT TASKS
' =====================

|Librarian|
:Add Books;
:Remove Books;
:Update Books;

:Search User;
:Check User Details;
:Fill in User Info;
:Edit User;
:Delete User;

:Check Book Details;
:Process Returns;
:Update Status;

stop
@enduml